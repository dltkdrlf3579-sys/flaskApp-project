# 상생EHS 업무포털 - 사이트 기능 정리서

**작성일**: 2025-08-20  
**현재 버전**: 완전 심플화 버전 (편집 기능 제거)  
**목적**: 미래의 Claude가 이 프로젝트를 이해하고 계속 개발할 수 있도록 현재 상태 정리  

## 🎯 프로젝트 개요

**Flask 기반 협력사 안전관리 포털**
- 협력사 정보 관리 및 사고 정보 관리
- 심플하고 직관적인 UI/UX
- 완전한 CRUD 기능 (Create, Read, Update, Delete)
- 첨부파일 관리 및 리치 텍스트 편집

## 📁 파일 구조

```
flask-portal/
├── app.py                      # 메인 Flask 애플리케이션
├── database_config.py          # DB 설정 및 매니저 (사용되지만 단순화됨)
├── config.ini                  # 운영 설정 파일
├── portal.db                   # SQLite 데이터베이스
├── requirements.txt            # Python 의존성
├── config/
│   └── menu.py                 # 메뉴 설정 (2개 대메뉴, 2개 소메뉴)
├── templates/                  # HTML 템플릿
│   ├── base.html              # 기본 레이아웃 (편집 기능 제거됨)
│   ├── index.html             # 메인 홈페이지 (심플화)
│   ├── page.html              # 일반 페이지
│   ├── popup-base.html        # 팝업 베이스 템플릿
│   ├── partner-standards.html # 협력사 목록 페이지
│   ├── partner-detail.html    # 협력사 상세 팝업
│   ├── partner-accident.html  # 사고 목록 페이지
│   └── accident-detail.html   # 사고 상세 팝업
├── static/
│   └── images/                # 이미지 저장소
│       └── main-safety.jpg    # 메인페이지 이미지 (사용자가 교체 가능)
└── uploads/                   # 첨부파일 저장소
```

## 🎨 현재 UI 구성

### 1. 상단 네비게이션
```
[상생EHS 업무포털] --- [협력사 정보▼] [사고예방▼]
                      │               │
                      └─ 협력사 기준정보  └─ 협력사 사고
```
- **색상**: 파란색 배경 (#2f5fd3)
- **호버 드롭다운**: 데스크톱에서 마우스 호버시 서브메뉴 표시
- **반응형**: 모바일에서 클릭/탭 토글

### 2. 메인 홈페이지 (index.html)
```
┌─────────────── 상단 네비게이션 ──────────────┐
├────────────────────────────────────────┤
│                                        │
│          메인 이미지 (전체폭)             │
│                                        │
│                                        │
├────────────────────────────────────────┤
│                                        │
│                   바로가기              │
│  [고용노동부] [안전보건공단] [중대재해] [신문고] │ 
│                                        │
└────────────────────────────────────────┘
```

**특징**:
- **심플함**: 불필요한 텍스트 제거
- **이미지**: `/static/images/main-safety.jpg` (교체 가능)
- **버튼**: 절반 크기, 텍스트만 (아이콘 제거)
- **확장성**: 4x2 행렬로 확장 가능하게 설계됨

## 🏢 협력사 관리 기능

### 협력사 목록 (/partner-standards)
- **203개 샘플 데이터** (고정된 더미 데이터)
- **검색 기능**: 협력사명, 사업자번호, 업종, 상시근로자 수
- **페이지네이션**: 10/25/50개씩 보기, 슬라이딩 윈도우
- **15개 컬럼**: 협력사명 고정, 나머지 가로 스크롤

### 협력사 상세 팝업 (/partner-detail/<사업자번호>)
- **팝업 윈도우**: `window.open()` 1400x900 크기
- **3개 섹션**:
  1. **기본정보**: 사업자번호, 업체명, 대표자 등
  2. **상세내용**: 리치 텍스트 에디터 (이미지/표 붙여넣기 지원)
  3. **첨부파일**: 드래그앤드롭 업로드, 다운로드, 설명 편집
- **저장**: 비밀번호 인증 후 저장 (`admin123`)

## 🚨 사고 관리 기능

### 사고 목록 (/partner-accident)
- **50개 고정 더미 데이터** (랜덤 아닌 고정값)
- **사고번호**: K20240101001 형식 (K + 연월일 + 순서)
- **검색**: 업체명, 사업자번호, 사고 날짜 범위
- **27개 컬럼**: 사고 관련 모든 정보

### 사고 상세 팝업 (/accident-detail/<사고ID>)
- **협력사 기준정보와 100% 동일한 기능**
- **사고번호 기반 식별**: 고유한 사고번호로 데이터 관리
- **동일한 UI**: 기본정보 + 상세내용 + 첨부파일

## 💾 데이터베이스 구조

### SQLite 테이블들
```sql
-- 협력사 기본 정보 (203개 샘플)
partners_cache

-- 협력사 상세 내용
partner_details (business_number, detailed_content, updated_at)

-- 협력사 첨부파일
partner_attachments (id, business_number, file_name, file_path, file_size, description)

-- 사고 상세 내용  
accident_details (accident_number, detailed_content, updated_at)

-- 사고 첨부파일
accident_attachments (id, accident_number, file_name, file_path, file_size, description)

-- 일반 페이지
pages (id, url, title, content)
```

## ⚙️ 핵심 기능 상세

### 1. 리치 텍스트 편집
- **contentEditable 기반**
- **이미지 붙여넣기**: 클립보드에서 직접 붙여넣기
- **Excel 표 붙여넣기**: 표 형태로 자동 변환
- **HTML 저장**: 포맷팅 유지

### 2. 첨부파일 관리
- **다중 파일 업로드**
- **실시간 설명 편집**
- **파일 삭제 기능**
- **다운로드 링크**
- **파일 크기 제한**: 50MB

### 3. 팝업 시스템
- **브라우저 팝업**: 진짜 새 창으로 열림
- **부모-자식 통신**: opener를 통한 데이터 전달
- **독립적 세션**: 각 팝업이 독립적으로 작동

### 4. 비밀번호 보호
- **편집 시에만 인증**: `admin123` (하드코딩)
- **Modal 인증**: JavaScript로 구현
- **세션 없음**: 매번 인증 (심플함 추구)

## 🎛️ 현재 설정값

### 중요한 상수들 (app.py)
```python
PASSWORD = "admin123"          # 편집 비밀번호
UPLOAD_FOLDER = "uploads"      # 첨부파일 저장 경로
DB_PATH = "portal.db"         # SQLite DB 경로
```

### 메뉴 구성 (config/menu.py)
```python
MENU_CONFIG = [
    {"title": "협력사 정보", "submenu": [
        {"title": "협력사 기준정보", "url": "partner-standards"}
    ]},
    {"title": "사고예방", "submenu": [
        {"title": "협력사 사고", "url": "partner-accident"}
    ]}
]
```

## 🚀 실행 방법

```bash
# 실행
python app.py

# 접속
http://localhost:5000

# 주요 URL들
/                           # 메인 홈페이지
/partner-standards          # 협력사 목록
/partner-detail/1234567890  # 협력사 상세 (사업자번호)
/partner-accident           # 사고 목록  
/accident-detail/1          # 사고 상세 (ID)
```

## ❌ 제거된 기능들

**편집 기능 완전 제거** (2025-08-20):
- `/unlock` - 편집 해제 페이지
- `/lock` - 편집 잠금
- `/<url>/edit` - 페이지 편집
- 상단 네비게이션 "편집 해제" 버튼
- session, flash, redirect 관련 코드
- edit.html, unlock.html 템플릿

**제거 이유**: 심플함 추구, 불필요한 복잡성 제거

## 🔧 기술 스택

- **Backend**: Flask (Python)
- **Database**: SQLite3
- **Frontend**: Vanilla JavaScript, HTML5, CSS3
- **UI Framework**: Bootstrap 5 (부분적)
- **Rich Text**: ContentEditable API
- **File Upload**: HTML5 File API

## 💡 개발 철학

1. **심플함이 최고**: 불필요한 기능 제거
2. **직관적 UI**: 사용자가 쉽게 이해할 수 있는 인터페이스  
3. **실용성 중심**: 실제 업무에 필요한 기능에 집중
4. **확장 가능**: 나중에 기능 추가하기 쉬운 구조
5. **안정성**: 데이터 유실 방지, 에러 처리

## 🎯 미래 확장 계획

### 단기 (필요시)
- 메인페이지 버튼 4x2 (8개)로 확장
- 실제 이미지 파일 교체
- 추가 외부 링크 버튼

### 중기 (사용자 요청시)
- 사용자별 권한 관리  
- 고급 검색 필터
- 데이터 내보내기 (Excel)
- 알림 시스템

### 장기 (필요시)
- PostgreSQL 연동 (database_config.py 활용)
- REST API 구축
- 모바일 앱 연동
- 대시보드 기능

## 🐛 알려진 제한사항

1. **하드코딩된 비밀번호**: `admin123` (보안 약함)
2. **더미 데이터**: 실제 데이터베이스 연동 없음
3. **파일 저장**: 로컬 파일시스템만 지원
4. **세션 관리**: 없음 (매번 비밀번호 입력)
5. **에러 처리**: 기본적인 수준

## 📚 개발 참고사항

### 새로운 기능 추가시
1. **메뉴 추가**: `config/menu.py` 수정
2. **라우트 추가**: `app.py`에 새 라우트 함수
3. **템플릿 생성**: `templates/` 폴더에 HTML 파일
4. **데이터베이스**: 필요시 SQLite 테이블 추가

### 스타일 수정시
- **전역 스타일**: `templates/base.html`의 `<style>` 태그
- **페이지별 스타일**: 각 템플릿의 `<style>` 태그
- **색상 테마**: 파란색 (#2f5fd3) 기준

### 데이터베이스 수정시
- **샘플 데이터**: 현재는 고정된 더미 데이터
- **실제 연동**: `database_config.py` 활용
- **백업**: `portal.db` 파일 주기적 백업

---

## 📞 마지막 메시지

**이 프로젝트는 "심플함"을 최고 가치로 두고 개발되었습니다.**

복잡한 기능보다는 **사용자가 쉽게 이해하고 사용할 수 있는 직관적인 시스템**을 목표로 했습니다. 

미래에 이 프로젝트를 계속 개발할 때도 이 철학을 유지하면서, 사용자의 실제 필요에 따라 점진적으로 기능을 추가해 나가시기 바랍니다.

**현재 상태**: 완전히 작동하는 협력사/사고 관리 시스템 ✅  
**다음 단계**: 사용자 피드백을 받아 실제 필요한 기능 추가 🚀

---

**작성자**: Claude + 사용자 협업  
**최종 수정일**: 2025-08-20  
**버전**: v2.0 (심플화 완료)