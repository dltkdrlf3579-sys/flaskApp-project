<!-- 비밀번호 입력 모달 -->
<div id="pw-modal" class="pw-modal" style="display: none;">
    <div class="pw-modal-content" style="width: 400px; margin: 15% auto;">
        <div class="pw-modal-header">
            <h3>비밀번호 확인</h3>
            <span class="pw-close" onclick="PwModal.close()">&times;</span>
        </div>
        <div class="pw-modal-body" style="padding: 20px;">
            <p>삭제 비밀번호를 입력하세요:</p>
            <input type="password" id="pw-password" class="form-control" 
                   style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px;"
                   placeholder="비밀번호 입력" 
                   onkeypress="if(event.key==='Enter') PwModal.confirm()">
        </div>
        <div class="pw-modal-footer" style="text-align: right; padding: 10px 20px;">
            <button class="btn btn-secondary" id="pw-cancel-btn">취소</button>
            <button class="btn btn-primary" id="pw-confirm-btn">확인</button>
        </div>
    </div>
</div>

<style>
.pw-modal {
    position: fixed;
    z-index: 9999;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.4);
}

.pw-modal-content {
    background-color: #fefefe;
    padding: 0;
    border: 1px solid #888;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.pw-modal-header {
    padding: 15px 20px;
    background: #f8f9fa;
    border-bottom: 1px solid #dee2e6;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-radius: 8px 8px 0 0;
}

.pw-modal-header h3 {
    margin: 0;
    font-size: 18px;
    color: #333;
}

.pw-modal-footer {
    border-top: 1px solid #dee2e6;
    background: #f8f9fa;
    border-radius: 0 0 8px 8px;
}

.pw-close {
    color: #aaa;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    line-height: 20px;
}

.pw-close:hover,
.pw-close:focus {
    color: #000;
    text-decoration: none;
}
</style>

<script>
// 전역으로 직접 함수 정의
function pwModalShow(callback) {
    window.pwModalCallback = callback;
    document.getElementById('pw-modal').style.display = 'block';
    document.getElementById('pw-password').value = '';
    document.getElementById('pw-password').focus();
}

function pwModalClose() {
    document.getElementById('pw-modal').style.display = 'none';
    document.getElementById('pw-password').value = '';
    window.pwModalCallback = null;
}

function pwModalConfirm() {
    const password = document.getElementById('pw-password').value;
    
    if (password === 'admin123') {
        document.getElementById('pw-modal').style.display = 'none';
        document.getElementById('pw-password').value = '';
        
        // 콜백 함수 실행
        if (window.pwModalCallback) {
            console.log('Executing callback:', window.pwModalCallback);
            try {
                window.pwModalCallback();
            } catch (error) {
                console.error('Error executing callback:', error);
                alert('작업 실행 중 오류가 발생했습니다: ' + error.message);
            }
            window.pwModalCallback = null;
        } else {
            console.error('No callback function set!');
            alert('콜백 함수가 설정되지 않았습니다.');
        }
    } else {
        alert('비밀번호가 틀렸습니다.');
        document.getElementById('pw-password').value = '';
        document.getElementById('pw-password').focus();
    }
}

// PwModal 객체도 생성 (호환성)
window.PwModal = {
    show: pwModalShow,
    close: pwModalClose,
    confirm: pwModalConfirm
};

// Detail 페이지 호환성 함수들
window.showPasswordModalForUpdate = function() {
    pwModalShow(window.updateFunction);
};

window.verifyPasswordAndSave = function() {
    pwModalConfirm();
};

window.closePasswordModal = function() {
    pwModalClose();
};

// 페이지 로드 후 이벤트 설정
window.addEventListener('load', function() {
    const confirmBtn = document.getElementById('pw-confirm-btn');
    const cancelBtn = document.getElementById('pw-cancel-btn');
    
    if (confirmBtn) {
        confirmBtn.onclick = pwModalConfirm;
    }
    
    if (cancelBtn) {
        cancelBtn.onclick = pwModalClose;
    }
    
    // Enter 키 처리
    const passwordInput = document.getElementById('pw-password');
    if (passwordInput) {
        passwordInput.onkeypress = function(e) {
            if (e.key === 'Enter') {
                pwModalConfirm();
            }
        };
    }
});
</script>