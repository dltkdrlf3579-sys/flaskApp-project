# 동적 컬럼 타입 변경 시 데이터 처리 규칙

## 데이터 타입 호환성 매트릭스

| 변경 전 → 변경 후 | 텍스트 | 드롭다운 | 날짜 | 담당자팝업 | 업체팝업 |
|-------------------|--------|----------|------|------------|----------|
| **텍스트**        | ✅ 유지 | ⚠️ 옵션매칭 | ⚠️ 형식검증 | ❌ 초기화 | ❌ 초기화 |
| **드롭다운**      | ✅ 유지 | ✅ 옵션재매칭 | ❌ 초기화 | ❌ 초기화 | ❌ 초기화 |
| **날짜**          | ✅ 유지 | ❌ 초기화 | ✅ 유지 | ❌ 초기화 | ❌ 초기화 |
| **담당자팝업**    | ⚠️ 이름만 | ❌ 초기화 | ❌ 초기화 | ✅ 유지 | ❌ 초기화 |
| **업체팝업**      | ⚠️ 이름만 | ❌ 초기화 | ❌ 초기화 | ❌ 초기화 | ✅ 유지 |

## 상세 규칙

### 1. 완전 호환 (✅)
- 데이터가 그대로 유지됨
- 예: 텍스트 → 텍스트, 날짜 → 텍스트

### 2. 부분 호환 (⚠️)
- **텍스트 → 드롭다운**: 옵션에 있는 값만 유지
- **텍스트 → 날짜**: YYYY-MM-DD 형식인 경우만 유지
- **팝업 → 텍스트**: 이름 정보만 추출하여 유지

### 3. 비호환 (❌)
- 데이터 초기화됨
- 예: 드롭다운 → 날짜, 날짜 → 담당자팝업

## 구현 방향

### 현재 (우연적 동작)
- 브라우저 단에서 자동 처리
- 일부 데이터 손실 발생

### 개선안 (의도적 구현)
```javascript
function convertDataByType(oldType, newType, oldValue) {
    // 호환성 체크
    if (oldType === newType) return oldValue;
    
    // 텍스트는 대부분 호환
    if (newType === 'text') {
        if (typeof oldValue === 'object') {
            return oldValue.name || '';
        }
        return oldValue;
    }
    
    // 드롭다운은 옵션 검증 필요
    if (newType === 'dropdown') {
        // 옵션에 있는지 확인
        return options.includes(oldValue) ? oldValue : '';
    }
    
    // 날짜는 형식 검증
    if (newType === 'date') {
        return isValidDate(oldValue) ? oldValue : '';
    }
    
    // 팝업 타입은 대부분 초기화
    if (newType.includes('popup')) {
        return '';
    }
}
```

## 사용자 알림
타입 변경 시 데이터 손실 가능성을 사용자에게 경고하는 것이 좋습니다.