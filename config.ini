# ======================================================================
# Flask Portal 설정 파일 템플릿
# 이 파일을 복사하여 config.ini로 저장하고 설정하세요
# ======================================================================

[DEFAULT]
# 기본 설정
DEBUG = False
SECRET_KEY = CHANGE-THIS-TO-RANDOM-SECRET-KEY
UPLOAD_FOLDER = uploads
EDIT_PASSWORD = admin123
ADMIN_PASSWORD = admin1233

[DATABASE]
# 로컬 SQLite (업무 데이터)
LOCAL_DB_PATH = portal.db

# IQADB 모듈 경로 설정 (본인의 환경에 맞게 수정하세요)
IQADB_MODULE_PATH = C:/Users/user/AppData/Local/aipforge/pkgs/dist/obf/PY310
# 기본 fallback 경로
DEFAULT_MODULE_PATH = C:/Users/user/AppData/Local/aipforge/pkgs/dist/obf/PY310

# 외부 DB만 사용 (캐시 없이 직접 연결)
EXTERNAL_DB_ENABLED = True

# 부트 동기화 플래그
INITIAL_SYNC_ON_FIRST_REQUEST = true
MASTER_DATA_DAILY = true
CONTENT_DATA_ONCE = true

[SECURITY]
# 보안 설정
MAX_UPLOAD_SIZE_MB = 10
ALLOWED_EXTENSIONS = pdf,doc,docx,xls,xlsx,png,jpg,jpeg

[LOGGING]
LOG_LEVEL = INFO
LOG_FILE = app.log

[DASHBOARD]
# 대시보드 설정
DASHBOARD_URL = https://your-dashboard.com
DASHBOARD_ENABLED = True

[SQL_QUERIES]
# ======================================================================
# 이 섹션은 더 이상 사용하지 않습니다
# 모든 쿼리는 [MASTER_DATA_QUERIES] 섹션으로 통합되었습니다
# ======================================================================

# ======================================================================
# 설정 가이드:
# 
# 1. 이 파일을 config.ini로 복사하세요
# 2. DEFAULT 섹션의 SECRET_KEY와 EDIT_PASSWORD를 변경하세요
# 3. PARTNERS_QUERY를 실제 DB 구조에 맞게 수정하세요
#    - your_schema.your_table → 실제 스키마.테이블명
#    - 컬럼명들을 실제 DB 컬럼명으로 변경
# 
# SQL 쿼리 수정 방법:
# - 실제 컬럼명으로 변경 (예: business_reg_no → 실제_사업자번호_컬럼)
# - AS 문으로 포털에서 사용할 이름 지정 (as business_number 유지)
# - 11개 컬럼 모두 맞춰주세요
# 
# 예시:
# real_column_name as portal_column_name
# ======================================================================

[COLUMNS]
# ======================================================================
# 컬럼 동기화 설정
# ======================================================================

# JSON 파일 자동 동기화 여부
# - true: 서버 시작할 때마다 JSON을 DB로 덮어씀 (기존 동작)
# - false: JSON은 최초 설치 때만 사용, 이후는 DB가 진실의 원천
SYNC_ON_STARTUP = false

[MASTER_DATA_QUERIES]
# ======================================================================
# 통합 마스터 데이터 쿼리 (모든 코드가 이 섹션 참조)
# ======================================================================

# SQL_QUERIES에서 복사해서 여기로 이동
PARTNERS_QUERY = SELECT 
    business_number,
    company_name,
    partner_class,
    business_type_major,
    business_type_minor,
    hazard_work_flag,
    representative,
    address,
    average_age,
    annual_revenue,
    transaction_count,
    permanent_workers
    FROM partners
    ORDER BY company_name

ACCIDENTS_QUERY = SELECT 
    accident_number,
    accident_name,
    workplace,
    accident_grade,
    major_category,
    injury_form,
    injury_type,
    accident_date,
    day_of_week,
    report_date,
    building,
    floor,
    location_category,
    location_detail
    FROM accidents
    WHERE accident_number IS NOT NULL

BUILDING_QUERY = SELECT building_code, building_name, SITE, SITE_TYPE FROM buildings WHERE 1=1

DEPARTMENT_QUERY = SELECT dept_code, dept_name, parent_dept_code, dept_level FROM departments WHERE 1=1

CONTRACTOR_QUERY = SELECT worker_id, worker_name, company_name, business_number FROM contractors WHERE 1=1

EMPLOYEE_QUERY = SELECT employee_id, employee_name, department_name FROM employees WHERE 1=1

[CONTENT_DATA_QUERIES]
# ======================================================================
# 컨텐츠 데이터 쿼리 (한번만 동기화)
# ======================================================================

# 안전지시서 쿼리 (MASTER_DATA_QUERIES에서 이동)
SAFETY_INSTRUCTIONS_QUERY = SELECT 
    issue_number,
    issuer,
    issuer_department,
    classification,
    employment_type,
    primary_company,
    primary_business_number,
    subcontractor,
    subcontractor_business_number,
    disciplined_person,
    disciplined_person_id,
    gbm,
    business_division,
    team,
    department,
    work_grade,
    violation_date,
    discipline_date,
    discipline_department,
    discipline_type,
    accident_type,
    accident_grade,
    safety_violation_grade,
    violation_type,
    access_ban_start_date,
    access_ban_end_date,
    period,
    penalty_points,
    violation_content,
    detailed_content
    FROM safety_instructions_cache
    WHERE issue_number IS NOT NULL AND (is_deleted = 0 OR is_deleted IS NULL)

# FOLLOWSOP, FULLPROCESS 쿼리는 필요시 추가
# FOLLOWSOP_QUERY = SELECT ...
# FULLPROCESS_QUERY = SELECT ...
